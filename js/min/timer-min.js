var t,TimerWidget,s,SettingsWidget,h,HistoryWidget,t,TimerWidget={settings:{timerSection:$("#timer"),timer:$("#time"),changeSettingsButton:$("#change-settings"),startPomodoroButton:$("#start-pomodoro"),startShortBreakButton:$("#start-short-break"),startLongBreakButton:$("#start-long-break"),progressNotification:$("#progress-notification"),pausePlay:$("#pause-play"),runningTimer:"",timerBegin:0,timerCountdown:1500,timerCountdownStart:1500,timerStart:moment(),pomoCount:0,statement:$("#statement"),timerEnd:moment(),timerType:"pomo",runningPauseTimer:"",pauseCounter:0,pauseStartMoment:moment(),pauseTime:$("#pause-time"),count:0,pauseCurrentMoment:moment(),pauseArea:$("#pause-area"),pauseText:$("#pause-text"),canvas:0,ctx:0,W:0,H:0,degrees:0,new_degrees:0,difference:0,color:"#EE424E",bgcolor:"#18191B",textColor:"#979797",text:"",animation_loop:"",redraw_loop:"",degreeCalculation:.24,playpause:!0,resetButton:$("#reset"),pauseMinuteDisplay:$("#pause-minute-display"),pauseSecondDisplay:$("#pause-second-display"),backgroundImage:$("#background-image"),startTime:$("#start-time")},init:function(){t=this.settings,this.bindUIActions(),TimerWidget.displayTimerFoyer(s.timerSetting),t.canvas=$("#timer-animation")[0],t.ctx=t.canvas.getContext("2d"),t.W=t.canvas.width,t.H=t.canvas.height,TimerWidget.draw()},bindUIActions:function(){t.changeSettingsButton.on("click",function(){SettingsWidget.enterSettings()}),t.resetButton.on("click",function(){TimerWidget.reset()}),t.pausePlay.click(function(){$(this).toggleClass("paused")}),t.pausePlay.on("click",function(){TimerWidget.setPlayPause()}),t.startPomodoroButton.on("click",function(){h.currentTask=h.taskInput.val(),h.taskInput.addClass("hide"),$(this).addClass("hide"),t.progressNotification.addClass("pomodoro-progress"),t.progressNotification.removeClass("hide short-break-progress long-break-setting"),""===h.currentTask&&(h.currentTask="Working Hard"),h.taskWritten.text(h.currentTask),h.taskWritten.removeClass("hide"),TimerWidget.cancelTimer(),t.timerType="pomo",t.timerCountdownStart=s.timerSetting,t.degrees=0,TimerWidget.startTimer(s.timerSetting,t.timerType)}),t.startShortBreakButton.on("click",function(){h.currentTask="Break Time",h.taskInput.addClass("hide"),$(this).addClass("hide"),t.progressNotification.addClass("short-break-progress"),t.progressNotification.removeClass("hide pomodoro-progress long-break-setting"),h.taskWritten.removeClass("hide"),TimerWidget.cancelTimer(),t.timerType="short-break",t.timerCountdownStart=s.shortBreakSetting,t.degrees=0,TimerWidget.startTimer(s.shortBreakSetting,t.timerType)}),t.startLongBreakButton.on("click",function(){h.currentTask="Long Break",h.taskInput.addClass("hide"),$(this).addClass("hide"),t.progressNotification.addClass("long-break-progress"),t.progressNotification.removeClass("hide short-break-progress pomodoro-progress"),h.taskWritten.removeClass("hide"),TimerWidget.cancelTimer(),t.timerType="long-break",t.timerCountdownStart=s.longBreakSetting,t.degrees=0,TimerWidget.startTimer(s.longBreakSetting,t.timerType)})},reset:function(){switch(TimerWidget.cancelTimer(),TimerWidget.cancelPauseTimer(),t.timerType){case"pomo":TimerWidget.showPomodoro();break;case"short-break":TimerWidget.showShortBreak();break;case"long-break":TimerWidget.showLongBreak();break;default:TimerWidget.showPomodoro()}},setPlayPause:function(){t.playpause=!t.playpause,t.playpause?(TimerWidget.cancelPauseTimer(),HistoryWidget.storeLocally({description:"Interrupted!",timeTaken:HistoryWidget.displayTimeTaken(t.count),timeStarted:t.pauseStartMoment.format("h:mm a"),timeEnded:t.pauseCurrentMoment.format("h:mm a"),id:t.pauseCurrentMoment.format("x"),date:t.timerEnd.format("MMMM Do YYYY"),type:"interrupted",timeLabel:h.timeLabel}),TimerWidget.startTimer(t.timerCountdown,t.timerType)):TimerWidget.pauseTimer()},pauseTimer:function(){t.timerEnd=moment(),clearInterval(t.runningTimer),HistoryWidget.storeLocally({description:h.currentTask,timeTaken:HistoryWidget.displayTimeTaken(t.timerBegin-t.timerCountdown),timeStarted:t.timerStart.format("h:mm a"),timeEnded:t.timerEnd.format("h:mm a"),id:t.timerEnd.format("x"),date:t.timerEnd.format("MMMM Do YYYY"),type:t.timerType,timeLabel:h.timeLabel}),t.pauseText.removeClass("hide"),t.pauseCounter=0,t.pauseStartMoment=moment();var e=Math.floor(t.pauseCounter/60),a=t.pauseCounter%60;t.pauseMinuteDisplay.text(TimerWidget.formatTime(e)),t.pauseSecondDisplay.text(TimerWidget.formatTime(a)),t.runningPauseTimer=setInterval(TimerWidget.intervalTimerUp,1e3)},cancelTimer:function(){t.timerEnd=moment(),clearInterval(t.runningTimer),t.timerCountdown=0},pomoFlow:function(e){"pomo"===e&&(t.pomoCount+=1,t.pomoCount%4===0?TimerWidget.showLongBreak():TimerWidget.showShortBreak()),"pomo"!==e&&TimerWidget.showPomodoro()},showPomodoro:function(){TimerWidget.displayTimerFoyer(s.timerSetting),t.startTime.removeClass("hide"),h.taskInput.removeClass("hide"),t.startPomodoroButton.removeClass("hide"),t.progressNotification.addClass("hide"),h.taskWritten.addClass("hide"),t.backgroundImage.removeClass("background__short-break background__long-break fade-out2"),t.backgroundImage.addClass("background__pomodoro fade-in2"),t.timer.removeClass("fade-in2"),t.timer.addClass("fade-out2"),t.timerType="pomo"},showLongBreak:function(){TimerWidget.displayTimerFoyer(s.longBreakSetting),t.startTime.removeClass("hide"),t.startLongBreakButton.removeClass("hide"),t.progressNotification.addClass("hide"),h.taskWritten.text("Nice work! Time to take a longer break."),t.backgroundImage.removeClass("background__short-break background__pomodoro fade-out2"),t.backgroundImage.addClass("background__long-break fade-in2"),t.timer.removeClass("fade-in2"),t.timer.addClass("fade-out2"),t.timerType="long-break",TimerWidget.cancelPauseTimer()},showShortBreak:function(){TimerWidget.displayTimerFoyer(s.shortBreakSetting),t.startTime.removeClass("hide"),t.startShortBreakButton.removeClass("hide"),t.progressNotification.addClass("hide"),h.taskWritten.text("Take a short break. You've earned it!"),t.backgroundImage.removeClass("background__long-break background__pomodoro fade-out2"),t.backgroundImage.addClass("background__short-break fade-in2"),t.timer.removeClass("fade-in2"),t.timer.addClass("fade-out2"),t.timerType="short-break",TimerWidget.cancelPauseTimer()},startTimer:function(e,a){t.timerBegin=e,t.timerStart=moment(),t.timerCountdown=e,t.degreeCalculation=360/t.timerCountdownStart,t.statement.addClass("hide"),TimerWidget.displayTimer(t.timerCountdown),TimerWidget.hideTimerFoyer(),t.runningTimer=setInterval(TimerWidget.intervalTimer,1e3,a),h.historyEmptyState.addClass("hide"),h.historyData.removeClass("hide")},chooseStatement:function(e){return"pomo"===e?t.pomoCount%4===0?"Take a long break!":"Take a short break!":"Back to work with you!"},intervalTimerUp:function(){t.pauseCurrentMoment=moment(),t.count=t.pauseCurrentMoment.diff(t.pauseStartMoment,"second");var e=Math.floor(t.count/60),a=t.count%60;t.pauseMinuteDisplay.text(TimerWidget.formatTime(e)),t.pauseSecondDisplay.text(TimerWidget.formatTime(a))},displayTimerFoyer:function(e){t.pauseArea.addClass("hide");var a=Math.floor(e/60),i=e%60;t.startTime.text(TimerWidget.formatTime(a)+":"+TimerWidget.formatTime(i))},cancelPauseTimer:function(){t.pausePlay.removeClass("paused"),t.playpause=!0,clearInterval(t.runningPauseTimer),t.degrees=t.new_degrees,t.pauseText.addClass("hide")},intervalTimer:function(e){t.timerCountdown<=1&&TimerWidget.cancelTimer(),t.timerCountdown>0?t.timerCountdown=t.timerBegin-Math.round((moment()-t.timerStart)/1e3):t.timerCountdown<=0&&(TimerWidget.pomoFlow(e),"short-break"===e||"long-break"===e?HistoryWidget.storeLocally({description:"Break Time",timeTaken:HistoryWidget.displayTimeTaken(t.timerBegin-t.timerCountdown),timeStarted:t.timerStart.format("h:mm a"),timeEnded:t.timerEnd.format("h:mm a"),id:t.timerEnd.format("x"),date:t.timerEnd.format("MMMM Do YYYY"),type:e,timeLabel:h.timeLabel}):HistoryWidget.storeLocally({description:h.currentTask,timeTaken:HistoryWidget.displayTimeTaken(t.timerBegin-t.timerCountdown),timeStarted:t.timerStart.format("h:mm a"),timeEnded:t.timerEnd.format("h:mm a"),id:t.timerEnd.format("x"),date:t.timerEnd.format("MMMM Do YYYY"),type:e,timeLabel:h.timeLabel})),TimerWidget.displayTimer(t.timerCountdown)},hideTimerFoyer:function(){t.timer.removeClass("fade-out2 fade-out").addClass("fade-in2"),t.backgroundImage.removeClass("fade-in2").addClass("fade-out2")},displayTimer:function(e){t.pauseArea.removeClass("hide");var a=Math.floor(e/60),i=e%60;t.text=""+TimerWidget.formatTime(a)+":"+TimerWidget.formatTime(i),TimerWidget.draw()},formatTime:function(t){return 10>t?"0"+t:t},initAnimation:function(){t.ctx.closePath(),t.ctx.clearRect(0,0,t.W,t.H),t.ctx.beginPath(),t.ctx.strokeStyle=t.bgcolor,t.ctx.lineWidth=15,t.ctx.arc(t.W/2,t.H/2,100,0,2*Math.PI,!1),t.ctx.stroke(),t.ctx.closePath();var e=t.degrees*Math.PI/180;t.ctx.beginPath(),t.ctx.strokeStyle=t.color,t.ctx.lineWidth=15,t.ctx.arc(t.W/2,t.H/2,100,0-90*Math.PI/180,e-90*Math.PI/180,!1),t.ctx.stroke(),t.ctx.fillStyle=t.textColor,t.ctx.font="300 50px lato";var a=t.ctx.measureText(t.text).width;t.ctx.fillText(t.text,t.W/2-a/2,t.H/2+15)},draw:function(){void 0!==typeof t.animation_loop&&clearInterval(t.animation_loop),t.new_degrees=Math.round((t.timerCountdownStart-t.timerCountdown)*t.degreeCalculation),t.difference=t.degrees-t.new_degrees,t.animation_loop=setInterval(TimerWidget.animate_to,1e3/t.difference)},animate_to:function(){t.degrees===t.new_degrees?clearInterval(t.animation_loop):t.degrees<t.new_degrees?t.degrees++:t.degrees--,TimerWidget.initAnimation()}},s,SettingsWidget={settings:{timeInput:$("#time-input"),shortBreakInput:$("#short-break"),longBreakInput:$("#long-break"),saveButton:$("#save-settings"),cancelButton:$("#cancel-settings"),settingsSection:$("#settings"),timerSetting:1500,shortBreakSetting:300,longBreakSetting:1200,localSettings:JSON.parse(localStorage.getItem("settingsData"))||{}},init:function(){s=this.settings,this.bindUIActions(),s.localSettings!=={}&&(s.timerSetting=60*s.localSettings.timerSetting,s.shortBreakSetting=60*s.localSettings.shortBreakSetting,s.longBreakSetting=60*s.localSettings.longBreakSetting,s.timeInput.attr("value",s.localSettings.timerSetting),s.shortBreakInput.attr("value",s.localSettings.shortBreakSetting),s.longBreakInput.attr("value",s.localSettings.longBreakSetting))},bindUIActions:function(){s.saveButton.on("click",function(){SettingsWidget.saveSettings()}),s.cancelButton.on("click",function(){SettingsWidget.exitSettings()})},saveSettings:function(){s.timerSetting=60*s.timeInput.val(),s.shortBreakSetting=60*s.shortBreakInput.val(),s.longBreakSetting=60*s.longBreakInput.val(),s.localSettings={timerSetting:s.timeInput.val(),shortBreakSetting:s.shortBreakInput.val(),longBreakSetting:s.longBreakInput.val()},localStorage.setItem("settingsData",JSON.stringify(s.localSettings)),TimerWidget.reset(),SettingsWidget.exitSettings()},enterSettings:function(){s.settingsSection.removeClass("hide"),$(".settings-modal").focus()},exitSettings:function(){s.settingsSection.addClass("hide")}},h,HistoryWidget={settings:{taskArea:$("#task-area"),taskInput:$("#task-input"),taskWritten:$("#task-written"),historyData:$("#history-data"),historyDataTable:$("#history-data-table"),historyEmptyState:$("#history-empty"),taskInputButton:$("#task-input-button"),data:JSON.parse(localStorage.getItem("taskData"))||{},clearHistory:$("#clear-history"),saveButton:$("#save-button"),taskSaveArea:$("#task-save-area"),cancelButton:$("#cancel-button"),currentTaskEdit:"",editTaskButton:$("#edit-task"),oldTaskInfo:"",exportButton:$("#export-table"),row:JSON.parse(localStorage.getItem("rowData"))||[],currentTask:"",dateArray:[],timeLabel:"min",taskSaveShowing:!1,saveCanceled:!1},init:function(){h=this.settings,this.bindUIActions(),$.each(h.data,function(t,e){HistoryWidget.addTask(e)}),$.isEmptyObject(h.data)?h.historyEmptyState.removeClass("hide"):(h.historyData.removeClass("hide"),h.historyEmptyState.addClass("hide"))},bindUIActions:function(){h.taskInput.keyup(function(e){13===e.which&&t.startPomodoroButton.click()}),h.clearHistory.on("click",function(){HistoryWidget.clearHistory()}),h.historyDataTable.on("click",".edit-task",function(){HistoryWidget.editTask(this)}),h.historyDataTable.on("focus",".history__task-description",function(){HistoryWidget.showSave($(this).attr("id"))}),h.historyDataTable.on("keydown",".history__task-description",function(t){return 13===t.which&&($(this).blur(),HistoryWidget.saveTask(h.currentTaskEdit)),13!==t.which}),h.historyDataTable.on("click","#save-button",function(){HistoryWidget.saveTask(h.currentTaskEdit)}),h.historyDataTable.on("click","#cancel-button",function(){HistoryWidget.cancelSave()}),h.exportButton.on("click",function(){HistoryWidget.exportTable()})},displayTimeTaken:function(t){var e=Math.round(t/60);return e>0?e:"<1"},editTask:function(t){var e=$(t).attr("id");$("#task-"+e).focus()},cancelSave:function(){""!==h.oldTaskInfo&&($("#"+h.currentTaskEdit).text(h.oldTaskInfo),h.oldTaskInfo=""),HistoryWidget.hideSave()},showSave:function(t){HistoryWidget.saveTask(h.currentTaskEdit),h.oldTaskInfo=$("#"+t).text(),h.currentTaskEdit=t,$("#"+h.currentTaskEdit).attr("tabindex","1").addClass("focus-border");var e=t.substring(10);if(!h.taskSaveShowing){var a=$("<div>",{id:"task-save-area","class":"task-save-area"}).insertAfter($("#"+e));$("<button>",{id:"save-button","class":"save-button button-small button__accent3 waves-effect waves-light",text:"Save"}).appendTo(a),$("<button>",{id:"cancel-button","class":"cancel-button button-ghost waves-effect waves-light",text:"Cancel"}).appendTo(a),h.taskSaveShowing=!0}},saveTask:function(t){if(""!==t){var e=$("#"+t).parent().parent().attr("id");h.data[e].description=$("#"+h.currentTaskEdit).text(),localStorage.setItem("taskData",JSON.stringify(h.data));for(var a=0;a<h.row.length;a++)h.row[a].id===e&&(h.row[a].task=$("#"+h.currentTaskEdit).text(),localStorage.setItem("rowData",JSON.stringify(h.row)));h.oldTaskInfo=""}HistoryWidget.hideSave()},hideSave:function(){$("#"+h.currentTaskEdit).prop("tabindex",null).removeClass("focus-border"),h.taskSaveArea=$("#task-save-area"),h.taskSaveArea.remove(),h.taskSaveShowing=!1},clearHistory:function(){localStorage.clear(),h.data={},h.row=[],h.dateArray=[],$("#history-data-body").empty(),$("#history-data").addClass("hide"),$("#history-empty").removeClass("hide")},storeLocally:function(t){h.data[t.id]=t,localStorage.setItem("taskData",JSON.stringify(h.data)),h.row.push({task:t.description,"time started":t.timeStarted,"time ended":t.timeEnded,id:t.id,"time spent":t.timeTaken}),localStorage.setItem("rowData",JSON.stringify(h.row)),HistoryWidget.addTask(t)},exportTable:function(){var t=[{title:"Task",dataKey:"task"},{title:"Start Time",dataKey:"time started"},{title:"Stop Time",dataKey:"time ended"},{title:"Duration",dataKey:"time spent"}],e=new jsPDF("p","pt");e.autoTable(t,h.row),e.save("table.pdf")},addTask:function(t){var e={taskItem:"history__task-item task-icon",taskDescription:"history__task-description",taskTime:"history__task-duration task-time__arrow",taskStart:"history__task-time",id:t.id,date:t.date,type:t.type,timeLabel:t.timeLabel};h.historyEmptyState.addClass("hide");var a=e.date;a=a.replace(/\s+/g,"-").toLowerCase(),$.inArray(e.date,h.dateArray)<=-1&&(h.dateArray.push(e.date),$("<div>",{"class":a}).prependTo($("#history-data-body")),$("<p>",{"class":"date-header",text:e.date}).appendTo($("."+a)),$("<div>",{"class":""+a+"-body"}).appendTo($("."+a)));var i=$("<div>",{"class":e.taskItem+" fade-in2 "+e.type+"-icon",id:e.id}).prependTo($("."+a+"-body")),r=$("<div>",{"class":e.taskTime+" arrow-"+e.type,text:t.timeTaken,"data-label":"Duration"}).appendTo(i);$("<abbr>",{"class":"history__task-duration-label",text:e.timeLabel}).appendTo(r);var o=$("<div>",{"class":"description-container",id:e.id+"-container","data-label":"Task"}).appendTo(i);$("<div>",{"class":e.taskDescription,text:t.description,id:"task-edit-"+e.id,contenteditable:"true"}).appendTo(o);var s=$("<div>",{"class":"history__task-time"}).appendTo(o);$("<div>",{"class":e.taskStart,text:t.timeStarted+" - "+t.timeEnded,"data-label":"Times"}).appendTo(s),$("<button>",{"class":"edit-task button-ghost waves-effect waves-light",id:"edit-"+e.id,text:"Edit"}).appendTo(i)}};$(document).ready(function(){"use strict";SettingsWidget.init(),TimerWidget.init(),HistoryWidget.init()});